## Security Onion
 * [security_onion](#security-onion)
  * [update](#so-update)
  * [services](#services)
  * [interfaces](#interfaces)
  * [docker containers](#docker-containers)
  * [so_firewall](#so-firewall)
  * [config files](#config-files)
  * [log files](#log-files)
 * [SGUIL]
 * [SQUERT]
 * [BRO]
 * [SNORT]
 * [LOGSTASH]
 * [ELASTICSEARCH]
 * [KIBANA]
 * [pulled port]
 * [my-sql]
 * [banyard2-1]
 * [pf_ring]
 * [cap me]
 * [apache]
 
### security_onion

**services running**
```bash
sudo sostat |less
```
data source available from elastic search
```
curl 'localhost:9200/_cat/indices?v'
```
https://localhost/apt/kibana
https://localhost/squert

#### [so update](https://github.com/Security-Onion-Solutions/security-onion/wiki/Upgrade)
```
#byobu before updating
# install byobu
sudo apt-get install byobu
# enable byobu
byobu-enable
# you're now ready to update


#ubuntu and security onion
sudo soup
#snort/suricata rules
sudo rule-update
#bro
sudo nsm_sensor_ps-restart --only-bro

#update pf_ring 
sudo apt-get update ; sudo apt-get install securityonion-pfring-module ; sudo apt-get dist-upgrade

#if snort dails after update
sudo apt-get install --reinstall securityonion-pfring-module
```

#### services
* squil-server
* ossec_agent
* bro
* betsniff-ng
* pcap_agent
* snort_agent-1
* snort-1
banyard2-1

#### interfaces
docker0 --> elk docker
eth0 --> management (lot of incoming and outgoing)
eth1 --> some incoming, 0 outgoing
eth2 --> 0, 0
eth3 --> most active incoming, 0 outgoing
eth4 --> some incoming, 0 outgoing
eth5 --> 0, 0
eth6 --> 0, 0
eth7 --> 0, 0
eth8 --> 0, 0
eth9 --> 0, 0
lo --> 17.2GB in, 17.2GB out

#### docker containers 
**so-curator**
**so-elastalert**
**so-kibana**
**so-logstash**
**so-elasticsearch**
**so-domainstats**
**so-freqserver** 

#### [so_firewall](https://github.com/Security-Onion-Solutions/security-onion/wiki/firewall)
```
sudo ufw  allow proto tcp from ip_address to any port 22,443,7734,514,5601
sudo ufw  allow proto udp from ip_address to any port 1514

sudo ufw delete allow proto tcp from ip_address to any port 22,443,7734,514,5601
sudo ufw delete allow proto udp from ip_address to any port 1514

sudo ufw status
```


#### config files
```
# ELK
/etc/kibana/kibana.yml

/opt/elastic/src/etc/kibana
/opt/elastic/src/configfiles
/opt/elastic/src/etc/elastalert/rules
/opt/elastic/src/etc/curator/config

/etc/nsm/pulledpork
/etc/nsm/administration.conf
/etc/nsm/securityonion.conf
```

#### log files
```
#snort logs - giberish
/nsm/sensor_data/host3-eth3/dailylogs

#bro logs - separate logs for each type of data (ssh, smtp, edp etc)
/nsm/bro/logs
```

administration.conf
```
NSM_LIB_DIR="/usr/lib/nsmnow"
NSM_GENERAL_LIB_DIR="/usr/lib"
NSM_GENERAL_BIN_DIR="/usr/bin"
NSM_GENERAL_SBIN_DIR="/usr/sbin"
NSM_GENERAL_ETC_DIR="/etc"
NSM_GENERAL_INIT_DIR="/etc/init.d"
NSM_GENERAL_CRON_DIR="/etc/cron.d"
SNORT_LIB_DIR="/usr/lib"
```

securityonion.conf
```
# /etc/nsm/securityonion.conf
# Generated by Security Onion Setup (sosetup) at Fri Dec 29 22:00:47 UTC 2017

# Which IDS engine would you like to run?
ENGINE=snort

# How many days would you like to keep in the Sguil database archive?
DAYSTOKEEP=30

# How many days worth of tables would you like to repair every day?
DAYSTOREPAIR=7

# At what percentage of disk usage should the NSM scripts warn you?
WARN_DISK_USAGE=80

# At what percentage of disk usage should the NSM scripts begin purging old data?
CRIT_DISK_USAGE=90

# Do you want to run Bro?  yes/no
BRO_ENABLED=yes

# BRO_USER specifies the user account used to start Bro.
BRO_USER=sguil
BRO_GROUP=sguil

# The OSSEC agent sends OSSEC HIDS alerts into the Sguil database.
# Do you want to run the OSSEC Agent?  yes/no
OSSEC_AGENT_ENABLED=yes

# OSSEC_AGENT_LEVEL specifies the level at which OSSEC alerts are sent to sguild.
OSSEC_AGENT_LEVEL=5

# Do you want to run Xplico?  yes/no
XPLICO_ENABLED=no

# LOCAL_HIDS_RULE_TUNING
# If set to no (default), sensor will copy OSSEC rules from master server as-is (no changes).
# If set to yes, sensor will keep its own copy of the OSSEC rules.
LOCAL_HIDS_RULE_TUNING=no

# LOCAL_NIDS_RULE_TUNING
# The effect of this option is different depending on whether this box is a server or not.
# SERVER
# LOCAL_NIDS_RULE_TUNING=yes
# rule-update will operate on a local copy of the rules instead of downloading rules from the Internet
# LOCAL_NIDS_RULE_TUNING=no
# rule-update will try to download rules from the Internet
# SENSOR-ONLY
# LOCAL_NIDS_RULE_TUNING=yes
# rule-update will copy rules from master server and then try to run PulledPork locally for tuning
# LOCAL_NIDS_RULE_TUNING=no
# rule-update will copy rules from master server as-is (no changes)
LOCAL_NIDS_RULE_TUNING=no

# OSSEC_AGENT_USER specifies the user account used to start the OSSEC agent for Sguil.
OSSEC_AGENT_USER=sguil

# Log size limit (GB) for Elasticsearch logs
LOG_SIZE_LIMIT=238

# Docker options
DOCKERNET="so-elastic-net"
DOCKER_BRIDGE="172.17.0.1/24"

# Elasticsearch options
ELASTICSEARCH_ENABLED="yes"
ELASTICSEARCH_HOST="localhost"
ELASTICSEARCH_PORT=9200
ELASTICSEARCH_PUBLISH_IP="127.0.0.1"
ELASTICSEARCH_HEAP="24738m"
ELASTICSEARCH_OPTIONS=""

# Logstash options
LOGSTASH_ENABLED="yes"
LOGSTASH_HOST="localhost"
LOGSTASH_PORT=9600
LOGSTASH_PUBLISH_IP="0.0.0.0"
LOGSTASH_HEAP="24738m"
LOGSTASH_OPTIONS=""

# Kibana options
KIBANA_ENABLED="yes"
KIBANA_INDEX=.kibana
KIBANA_VERSION=5.6.5
KIBANA_DEFAULTAPPID="dashboard/94b52620-342a-11e7-9d52-4f090484f59e"
KIBANA_OPTIONS=""

# ElastAlert options
ELASTALERT_ENABLED="yes"
ELASTALERT_INDEX="elastalert_status"
ELASTALERT_OPTIONS=""

# Curator options
CURATOR_ENABLED="yes"
CURATOR_OPTIONS=""

# Freq_server default options
FREQ_SERVER_ENABLED="yes"
FREQ_SERVER_OPTIONS=""

# Domain_stats options
DOMAIN_STATS_ENABLED="yes"
DOMAIN_STATS_OPTIONS=""

# so-crossclustercheck options
CROSSCLUSTER_CHECK_ENABLED="yes"

# What is the maximum number of uncategorized events to allow?
# If this number gets too high, then sguild startup may be delayed.
UNCAT_MAX=100000

```

### [pulled pork](#https://github.com/shirkdog/pulledpork)
* downloaded at 7:01 UTC everyday